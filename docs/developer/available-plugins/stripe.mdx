---
title: Stripe
---

Stripe plugin uses [custom payment flow](https://stripe.com/docs/payments/accept-a-payment?platform=web&ui=elements) to process customer transactions.

## Creating payment in Saleor

To proper create a payment you need to finalize steps described in 
[Creating a checkout session](developer/checkout.mdx#creating-a-checkout-session) and 
[Selecting a shipping method](developer/checkout.mdx#selecting-a-shipping-method).

The next step is selecting Stripe as a payment gateway that we want to use to process checkout. 
For Stripe payment gateway we need to provide: `checkoutId`, and `input` with `gateway` and `amount`.

:::note

Description of `checkoutPaymentCreate` mutation can be found [here](developer/checkout#selecting-a-payment-method)

:::

```graphql
mutation {
  checkoutPaymentCreate(
    checkoutId: "Q2hlY2tvdXQ6MWZiMmM1OGUtN2JhMy00YmY5LWI2ZDItNWY2ZWJiN2U3ZWJj"
    input: {
      gateway: "saleor.payments.stripe",
      amount: 45.61
    }
  ) {
    payment {
      id
      chargeStatus
    }
    paymentErrors {
      field
      message
    }
  }
}
```

## Completing the checkout
After we create a payment object for Stripe payment gateway, 
we can call `checkoutComplete` mutation.  The first call of `checkoutComplete` for checkout,
 creates [Stripe payment intent object](https://stripe.com/docs/api/payment_intents/object).

 ```graphql
 mutation {
  checkoutComplete(checkoutId: "Q2hlY2tvdXQ6YjBhYTUzMWItYjc3NS00MzM3LTkxNzEtYTgzOTYwYThjMmVk"){
    order{
      id
      userEmail
      created
    }
    confirmationNeeded
    confirmationData
    checkoutErrors{
      field
      message
      code
    }
  }
}
 ```

 As a result, we get details required to finalize a payment.

```json
{
  "data": {
    "checkoutComplete": {
      "order": null,
      "confirmationNeeded": true,
      "confirmationData": "{\"client_secret\": \"pi_1J2Yh3H1Vac4G4dbfuBvQhTe_secret_DkwP8jcdenirqazGpjPvSaPtV\", \"id\": \"pi_1J2Yh3H1Vac4G4dbfuBvQhTe\"}",
      "checkoutErrors": []
    }
  }
}
```

`client_secret` is required to process a customer payment.
Steps required to finalize a payment transaction are described in [Stripe documentation](https://stripe.com/docs/payments/accept-a-payment?platform=web&ui=elements).


When customer finalizes a payment. Stripe sends a webhook notification with all details 
related to this payment. Saleor asynchronously receives the notification and 
completes checkout process.

On client-side, when `stripe.confirmCardPayment` doesn't return an error as 
[descirbed here](https://stripe.com/docs/payments/accept-a-payment?platform=web&ui=elements#web-submit-payment),  
client-side can call  `checkoutComplete` one more time.
 Saleor confirms that the payment has success status and returns an order object.

 ```graphql
 mutation {
  checkoutComplete(checkoutId: "Q2hlY2tvdXQ6YjBhYTUzMWItYjc3NS00MzM3LTkxNzEtYTgzOTYwYThjMmVk"){
    order{
      id
      userEmail
      created
    }
    confirmationNeeded
    confirmationData
    checkoutErrors{
      field
      message
      code
    }
  }
}
```

As a result we get order object.
```json
{
  "data": {
    "checkoutComplete": {
      "order": {
        "id": "T3JkZXI6MjI0Mw==",
        "userEmail": "m...@mirumee.com",
        "created": "2021-06-04T09:24:44.552881+00:00"
      },
      "confirmationNeeded": false,
      "confirmationData": "{}",
      "checkoutErrors": []
    }
  }
}
```

## Stripe webhooks

By activating a plugin, Saleor automatically subscribes to below Stripe's webhook events:

- `payment_intent.succeeded`
- `payment_intent.processing`
- `payment_intent.payment_failed`
- `payment_intent.amount_capturable_updated`
- `payment_intent.canceled`
- `charge.refunded`